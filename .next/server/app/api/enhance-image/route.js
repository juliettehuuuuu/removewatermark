/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/enhance-image/route";
exports.ids = ["app/api/enhance-image/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fenhance-image%2Froute&page=%2Fapi%2Fenhance-image%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fenhance-image%2Froute.ts&appDir=%2FUsers%2Ftutu%2FDesktop%2FBe%20a%20Developer%2Fmy-ai-tool-project%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ftutu%2FDesktop%2FBe%20a%20Developer%2Fmy-ai-tool-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fenhance-image%2Froute&page=%2Fapi%2Fenhance-image%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fenhance-image%2Froute.ts&appDir=%2FUsers%2Ftutu%2FDesktop%2FBe%20a%20Developer%2Fmy-ai-tool-project%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ftutu%2FDesktop%2FBe%20a%20Developer%2Fmy-ai-tool-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_tutu_Desktop_Be_a_Developer_my_ai_tool_project_src_app_api_enhance_image_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/enhance-image/route.ts */ \"(rsc)/./src/app/api/enhance-image/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/enhance-image/route\",\n        pathname: \"/api/enhance-image\",\n        filename: \"route\",\n        bundlePath: \"app/api/enhance-image/route\"\n    },\n    resolvedPagePath: \"/Users/tutu/Desktop/Be a Developer/my-ai-tool-project/src/app/api/enhance-image/route.ts\",\n    nextConfigOutput,\n    userland: _Users_tutu_Desktop_Be_a_Developer_my_ai_tool_project_src_app_api_enhance_image_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZlbmhhbmNlLWltYWdlJTJGcm91dGUmcGFnZT0lMkZhcGklMkZlbmhhbmNlLWltYWdlJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGZW5oYW5jZS1pbWFnZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnR1dHUlMkZEZXNrdG9wJTJGQmUlMjBhJTIwRGV2ZWxvcGVyJTJGbXktYWktdG9vbC1wcm9qZWN0JTJGc3JjJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRnR1dHUlMkZEZXNrdG9wJTJGQmUlMjBhJTIwRGV2ZWxvcGVyJTJGbXktYWktdG9vbC1wcm9qZWN0JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUN3QztBQUNySDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNEQUFzRDtBQUM5RDtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUMwRjs7QUFFMUYiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL3R1dHUvRGVza3RvcC9CZSBhIERldmVsb3Blci9teS1haS10b29sLXByb2plY3Qvc3JjL2FwcC9hcGkvZW5oYW5jZS1pbWFnZS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZW5oYW5jZS1pbWFnZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2VuaGFuY2UtaW1hZ2VcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2VuaGFuY2UtaW1hZ2Uvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvdHV0dS9EZXNrdG9wL0JlIGEgRGV2ZWxvcGVyL215LWFpLXRvb2wtcHJvamVjdC9zcmMvYXBwL2FwaS9lbmhhbmNlLWltYWdlL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fenhance-image%2Froute&page=%2Fapi%2Fenhance-image%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fenhance-image%2Froute.ts&appDir=%2FUsers%2Ftutu%2FDesktop%2FBe%20a%20Developer%2Fmy-ai-tool-project%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ftutu%2FDesktop%2FBe%20a%20Developer%2Fmy-ai-tool-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/enhance-image/route.ts":
/*!********************************************!*\
  !*** ./src/app/api/enhance-image/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_replicate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/replicate */ \"(rsc)/./src/lib/replicate.ts\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n\n\n\n\n// 内存中简单存储用户每日调用次数（生产环境建议用数据库）\nconst userUsageMap = new Map();\nconst DAILY_LIMIT = 10;\n// 高清化API路由，POST方法，接收图片并返回处理后图片URL\nasync function POST(req) {\n    // 登录校验\n    const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_2__.getServerSession)(_lib_auth__WEBPACK_IMPORTED_MODULE_3__.authOptions);\n    if (!session || !session.user?.email) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Not authenticated'\n        }, {\n            status: 401\n        });\n    }\n    const userId = session.user.email;\n    const today = new Date().toISOString().slice(0, 10);\n    const usage = userUsageMap.get(userId);\n    if (!usage || usage.date !== today) {\n        userUsageMap.set(userId, {\n            date: today,\n            count: 1\n        });\n    } else if (usage.count >= DAILY_LIMIT) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Daily free limit reached'\n        }, {\n            status: 429\n        });\n    } else {\n        usage.count++;\n        userUsageMap.set(userId, usage);\n    }\n    const formData = await req.formData();\n    const file = formData.get('image');\n    if (!file) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'No image uploaded'\n        }, {\n            status: 400\n        });\n    }\n    const resultUrl = await (0,_lib_replicate__WEBPACK_IMPORTED_MODULE_1__.callReplicateAPI)('enhance', file);\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        resultUrl,\n        remaining: DAILY_LIMIT - userUsageMap.get(userId).count\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9lbmhhbmNlLWltYWdlL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUF1RDtBQUNMO0FBQ047QUFDSjtBQUV4Qyw4QkFBOEI7QUFDOUIsTUFBTUksZUFBZSxJQUFJQztBQUN6QixNQUFNQyxjQUFjO0FBRXBCLGtDQUFrQztBQUMzQixlQUFlQyxLQUFLQyxHQUFnQjtJQUN6QyxPQUFPO0lBQ1AsTUFBTUMsVUFBVSxNQUFNUCwyREFBZ0JBLENBQUNDLGtEQUFXQTtJQUNsRCxJQUFJLENBQUNNLFdBQVcsQ0FBQ0EsUUFBUUMsSUFBSSxFQUFFQyxPQUFPO1FBQ3BDLE9BQU9YLHFEQUFZQSxDQUFDWSxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFvQixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUN6RTtJQUNBLE1BQU1DLFNBQVNOLFFBQVFDLElBQUksQ0FBQ0MsS0FBSztJQUNqQyxNQUFNSyxRQUFRLElBQUlDLE9BQU9DLFdBQVcsR0FBR0MsS0FBSyxDQUFDLEdBQUc7SUFDaEQsTUFBTUMsUUFBUWhCLGFBQWFpQixHQUFHLENBQUNOO0lBQy9CLElBQUksQ0FBQ0ssU0FBU0EsTUFBTUUsSUFBSSxLQUFLTixPQUFPO1FBQ2xDWixhQUFhbUIsR0FBRyxDQUFDUixRQUFRO1lBQUVPLE1BQU1OO1lBQU9RLE9BQU87UUFBRTtJQUNuRCxPQUFPLElBQUlKLE1BQU1JLEtBQUssSUFBSWxCLGFBQWE7UUFDckMsT0FBT04scURBQVlBLENBQUNZLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQTJCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ2hGLE9BQU87UUFDTE0sTUFBTUksS0FBSztRQUNYcEIsYUFBYW1CLEdBQUcsQ0FBQ1IsUUFBUUs7SUFDM0I7SUFDQSxNQUFNSyxXQUFXLE1BQU1qQixJQUFJaUIsUUFBUTtJQUNuQyxNQUFNQyxPQUFPRCxTQUFTSixHQUFHLENBQUM7SUFDMUIsSUFBSSxDQUFDSyxNQUFNO1FBQ1QsT0FBTzFCLHFEQUFZQSxDQUFDWSxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFvQixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUN6RTtJQUNBLE1BQU1hLFlBQVksTUFBTTFCLGdFQUFnQkEsQ0FBQyxXQUFXeUI7SUFDcEQsT0FBTzFCLHFEQUFZQSxDQUFDWSxJQUFJLENBQUM7UUFBRWU7UUFBV0MsV0FBV3RCLGNBQWNGLGFBQWFpQixHQUFHLENBQUNOLFFBQVNTLEtBQUs7SUFBQztBQUNqRyIsInNvdXJjZXMiOlsiL1VzZXJzL3R1dHUvRGVza3RvcC9CZSBhIERldmVsb3Blci9teS1haS10b29sLXByb2plY3Qvc3JjL2FwcC9hcGkvZW5oYW5jZS1pbWFnZS9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBjYWxsUmVwbGljYXRlQVBJIH0gZnJvbSAnQC9saWIvcmVwbGljYXRlJ1xuaW1wb3J0IHsgZ2V0U2VydmVyU2Vzc2lvbiB9IGZyb20gJ25leHQtYXV0aCdcbmltcG9ydCB7IGF1dGhPcHRpb25zIH0gZnJvbSAnQC9saWIvYXV0aCdcblxuLy8g5YaF5a2Y5Lit566A5Y2V5a2Y5YKo55So5oi35q+P5pel6LCD55So5qyh5pWw77yI55Sf5Lqn546v5aKD5bu66K6u55So5pWw5o2u5bqT77yJXG5jb25zdCB1c2VyVXNhZ2VNYXAgPSBuZXcgTWFwPHN0cmluZywgeyBkYXRlOiBzdHJpbmcsIGNvdW50OiBudW1iZXIgfT4oKVxuY29uc3QgREFJTFlfTElNSVQgPSAxMFxuXG4vLyDpq5jmuIXljJZBUEnot6/nlLHvvIxQT1NU5pa55rOV77yM5o6l5pS25Zu+54mH5bm26L+U5Zue5aSE55CG5ZCO5Zu+54mHVVJMXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIC8vIOeZu+W9leagoemqjFxuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucylcbiAgaWYgKCFzZXNzaW9uIHx8ICFzZXNzaW9uLnVzZXI/LmVtYWlsKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdOb3QgYXV0aGVudGljYXRlZCcgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICB9XG4gIGNvbnN0IHVzZXJJZCA9IHNlc3Npb24udXNlci5lbWFpbFxuICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLCAxMClcbiAgY29uc3QgdXNhZ2UgPSB1c2VyVXNhZ2VNYXAuZ2V0KHVzZXJJZClcbiAgaWYgKCF1c2FnZSB8fCB1c2FnZS5kYXRlICE9PSB0b2RheSkge1xuICAgIHVzZXJVc2FnZU1hcC5zZXQodXNlcklkLCB7IGRhdGU6IHRvZGF5LCBjb3VudDogMSB9KVxuICB9IGVsc2UgaWYgKHVzYWdlLmNvdW50ID49IERBSUxZX0xJTUlUKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdEYWlseSBmcmVlIGxpbWl0IHJlYWNoZWQnIH0sIHsgc3RhdHVzOiA0MjkgfSlcbiAgfSBlbHNlIHtcbiAgICB1c2FnZS5jb3VudCsrXG4gICAgdXNlclVzYWdlTWFwLnNldCh1c2VySWQsIHVzYWdlKVxuICB9XG4gIGNvbnN0IGZvcm1EYXRhID0gYXdhaXQgcmVxLmZvcm1EYXRhKClcbiAgY29uc3QgZmlsZSA9IGZvcm1EYXRhLmdldCgnaW1hZ2UnKSBhcyBGaWxlIHwgbnVsbFxuICBpZiAoIWZpbGUpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ05vIGltYWdlIHVwbG9hZGVkJyB9LCB7IHN0YXR1czogNDAwIH0pXG4gIH1cbiAgY29uc3QgcmVzdWx0VXJsID0gYXdhaXQgY2FsbFJlcGxpY2F0ZUFQSSgnZW5oYW5jZScsIGZpbGUpXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHJlc3VsdFVybCwgcmVtYWluaW5nOiBEQUlMWV9MSU1JVCAtIHVzZXJVc2FnZU1hcC5nZXQodXNlcklkKSEuY291bnQgfSlcbn0gIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNhbGxSZXBsaWNhdGVBUEkiLCJnZXRTZXJ2ZXJTZXNzaW9uIiwiYXV0aE9wdGlvbnMiLCJ1c2VyVXNhZ2VNYXAiLCJNYXAiLCJEQUlMWV9MSU1JVCIsIlBPU1QiLCJyZXEiLCJzZXNzaW9uIiwidXNlciIsImVtYWlsIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwidXNlcklkIiwidG9kYXkiLCJEYXRlIiwidG9JU09TdHJpbmciLCJzbGljZSIsInVzYWdlIiwiZ2V0IiwiZGF0ZSIsInNldCIsImNvdW50IiwiZm9ybURhdGEiLCJmaWxlIiwicmVzdWx0VXJsIiwicmVtYWluaW5nIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/enhance-image/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions),\n/* harmony export */   providerMap: () => (/* binding */ providerMap)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n\nconst providers = [];\n// Google Auth (如果配置了)\n// 已移除\n// Github Auth (如果配置了)\n// 已移除\n// 🔥 简化的邮箱登录 - 只使用Supabase认证\nif (true) {\n    providers.push((0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n        id: \"credentials\",\n        name: \"credentials\",\n        credentials: {\n            email: {\n                label: \"Email\",\n                type: \"email\"\n            },\n            password: {\n                label: \"Password\",\n                type: \"password\"\n            }\n        },\n        async authorize (credentials) {\n            if (!credentials?.email || !credentials?.password) {\n                return null;\n            }\n            // 🎯 开发环境测试账户（无需数据库）\n            if ( true && credentials.email === \"test@example.com\" && credentials.password === \"password\") {\n                return {\n                    id: \"test-user-id\",\n                    email: \"test@example.com\",\n                    name: \"Test User\"\n                };\n            }\n            // 🚀 生产环境：使用Supabase认证（自带邮箱验证）\n            try {\n                console.log('🔍 开始Supabase登录验证:', credentials.email);\n                const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(\"https://pyppocnuyvkhyvcfrpmn.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5cHBvY251eXZraHl2Y2ZycG1uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzMzUzMjksImV4cCI6MjA2NTkxMTMyOX0.2Y9CP3G8LpORWxeurajXRcCY7mRfESkjeaxFQ7kRgeQ\");\n                console.log('🔍 Supabase客户端创建成功');\n                // 🔐 Supabase登录验证（自动检查邮箱验证状态）\n                const { data, error } = await supabase.auth.signInWithPassword({\n                    email: credentials.email,\n                    password: credentials.password\n                });\n                console.log('🔍 Supabase登录结果:', {\n                    success: !error,\n                    error: error?.message,\n                    userExists: !!data?.user,\n                    userId: data?.user?.id\n                });\n                if (error) {\n                    // 如果是邮箱未验证错误，在开发环境下允许登录\n                    if (error.message === 'Email not confirmed' && \"development\" === 'development') {\n                        console.log('🔧 开发环境：允许未验证邮箱的用户登录');\n                        // 尝试手动确认邮箱\n                        try {\n                            const adminSupabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(\"https://pyppocnuyvkhyvcfrpmn.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY);\n                            // 先查询用户ID\n                            const { data: userData } = await adminSupabase.auth.admin.listUsers();\n                            const targetUser = userData.users.find((u)=>u.email === credentials.email);\n                            if (targetUser) {\n                                const { error: confirmError } = await adminSupabase.auth.admin.updateUserById(targetUser.id, {\n                                    email_confirm: true\n                                });\n                                if (!confirmError) {\n                                    console.log('✅ 邮箱确认成功，允许登录');\n                                    return {\n                                        id: targetUser.id,\n                                        email: credentials.email,\n                                        name: targetUser.user_metadata?.name || credentials.email\n                                    };\n                                }\n                            }\n                        } catch (confirmErr) {\n                            console.error('❌ 邮箱确认失败:', confirmErr);\n                        }\n                    }\n                    console.log('❌ 登录失败:', error.message);\n                    return null;\n                }\n                if (!data.user) {\n                    console.log('❌ 用户不存在');\n                    return null;\n                }\n                console.log('✅ 登录成功，返回用户信息');\n                // 🎉 登录成功\n                return {\n                    id: data.user.id,\n                    email: data.user.email,\n                    name: data.user.user_metadata?.name || data.user.email\n                };\n            } catch (error) {\n                console.error('❌ Supabase认证异常:', error);\n                return null;\n            }\n        }\n    }));\n}\nconst providerMap = providers.map((provider)=>{\n    if (typeof provider === \"function\") {\n        const providerData = provider();\n        return {\n            id: providerData.id,\n            name: providerData.name\n        };\n    } else {\n        return {\n            id: provider.id,\n            name: provider.name\n        };\n    }\n});\nconst authOptions = {\n    providers,\n    pages: {\n        signIn: \"/auth/signin\"\n    },\n    // 🍪 Cookie安全配置 - 优化以支持Google One Tap\n    cookies: {\n        sessionToken: {\n            name: `next-auth.session-token`,\n            options: {\n                httpOnly: true,\n                sameSite: 'lax',\n                path: '/',\n                secure: \"development\" === 'production',\n                domain:  false ? 0 : undefined\n            }\n        },\n        callbackUrl: {\n            name: `next-auth.callback-url`,\n            options: {\n                sameSite: 'lax',\n                path: '/',\n                secure: \"development\" === 'production',\n                domain:  false ? 0 : undefined\n            }\n        },\n        csrfToken: {\n            name: `next-auth.csrf-token`,\n            options: {\n                httpOnly: true,\n                sameSite: 'lax',\n                path: '/',\n                secure: \"development\" === 'production',\n                domain:  false ? 0 : undefined\n            }\n        },\n        // 🔧 添加状态Cookie配置以支持Google One Tap\n        state: {\n            name: `next-auth.state`,\n            options: {\n                httpOnly: true,\n                sameSite: 'lax',\n                path: '/',\n                secure: \"development\" === 'production',\n                maxAge: 900,\n                domain:  false ? 0 : undefined\n            }\n        },\n        pkceCodeVerifier: {\n            name: `next-auth.pkce.code_verifier`,\n            options: {\n                httpOnly: true,\n                sameSite: 'lax',\n                path: '/',\n                secure: \"development\" === 'production',\n                maxAge: 900,\n                domain:  false ? 0 : undefined\n            }\n        }\n    },\n    callbacks: {\n        async signIn ({ user, account, profile }) {\n            // 🎯 处理用户登录和首次注册赠送积分\n            console.log('🔍 signIn回调触发:', {\n                user: user,\n                account: account?.provider,\n                profile: profile?.email\n            });\n            try {\n                if (user?.email) {\n                    console.log('🔍 开始处理用户:', user.email);\n                    // 🔧 使用Supabase替代Prisma，确保数据库访问一致性\n                    const { createAdminClient } = await Promise.all(/*! import() */[__webpack_require__.e(\"vendor-chunks/@supabase\"), __webpack_require__.e(\"_rsc_src_lib_supabase_server_ts\")]).then(__webpack_require__.bind(__webpack_require__, /*! @/lib/supabase/server */ \"(rsc)/./src/lib/supabase/server.ts\"));\n                    const { getUuid } = await Promise.all(/*! import() */[__webpack_require__.e(\"vendor-chunks/uuid\"), __webpack_require__.e(\"_rsc_src_lib_utils_hash_ts\")]).then(__webpack_require__.bind(__webpack_require__, /*! @/lib/utils/hash */ \"(rsc)/./src/lib/utils/hash.ts\"));\n                    console.log('🔍 Supabase模块导入成功');\n                    const supabase = createAdminClient();\n                    // 检查用户是否已存在\n                    console.log('🔍 查询现有用户...');\n                    const { data: existingUser, error: findError } = await supabase.from('users').select('*').eq('email', user.email).limit(1).single();\n                    console.log('🔍 查询结果:', existingUser ? '用户已存在' : '用户不存在');\n                    if (findError && findError.code === 'PGRST116') {\n                        // 用户不存在，创建新用户\n                        console.log('🎁 开始创建新用户...');\n                        const newUserData = {\n                            id: user.id || getUuid(),\n                            email: user.email,\n                            name: user.name || user.email,\n                            image: user.image || '',\n                            credits: 100,\n                            signin_type: account?.type || 'oauth',\n                            signin_provider: account?.provider || 'google',\n                            signin_openid: account?.providerAccountId || '',\n                            signin_ip: 'unknown',\n                            last_signin_at: new Date().toISOString(),\n                            signin_count: 1,\n                            location: 'US',\n                            preferred_currency: 'USD',\n                            preferred_payment_provider: 'creem'\n                        };\n                        const { data: newUser, error: createError } = await supabase.from('users').insert(newUserData).select().single();\n                        if (createError) {\n                            console.error('🚨 新用户创建失败:', createError);\n                        // 即使创建失败，也允许用户登录，后续通过API自动创建\n                        } else {\n                            console.log('🎉 新用户创建成功:', newUser.id);\n                            // 🎁 创建积分赠送记录\n                            try {\n                                await supabase.from('credit_transactions').insert({\n                                    id: getUuid(),\n                                    user_id: newUser.id,\n                                    amount: 100,\n                                    type: 'gift',\n                                    description: '新用户注册赠送积分',\n                                    reference_id: 'welcome_bonus'\n                                });\n                                console.log(`🎁 新用户注册成功，赠送100积分: ${user.email}`);\n                            } catch (creditError) {\n                                console.error('⚠️ 积分记录创建失败:', creditError);\n                            }\n                        }\n                    } else if (!findError && existingUser) {\n                        console.log('🔄 更新现有用户登录信息...');\n                        // 🔄 现有用户：更新登录信息\n                        const updateData = {\n                            last_signin_at: new Date().toISOString(),\n                            signin_count: (existingUser.signin_count || 0) + 1,\n                            // 更新头像和昵称（如果有变化）\n                            ...user.image && {\n                                image: user.image\n                            },\n                            ...user.name && {\n                                name: user.name\n                            }\n                        };\n                        await supabase.from('users').update(updateData).eq('id', existingUser.id);\n                        console.log('✅ 现有用户登录信息更新完成');\n                    } else {\n                        console.error('🚨 数据库查询异常:', findError);\n                    }\n                } else {\n                    console.log('⚠️ 用户邮箱为空，跳过数据库操作');\n                }\n            } catch (error) {\n                console.error('❌ 用户登录处理失败:', error);\n            // 即使数据库操作失败，也允许用户登录\n            }\n            console.log('✅ signIn回调完成，返回true');\n            return true;\n        },\n        async redirect ({ url, baseUrl }) {\n            // 🎯 修改重定向逻辑 - 优先跳转到tool页面（AI图像去水印工具）\n            // 如果URL包含callbackUrl参数，使用该参数\n            if (url.includes('callbackUrl=')) {\n                const urlParams = new URLSearchParams(url.split('?')[1]);\n                const callbackUrl = urlParams.get('callbackUrl');\n                if (callbackUrl) {\n                    // 解码callbackUrl\n                    const decodedCallback = decodeURIComponent(callbackUrl);\n                    if (decodedCallback.startsWith(\"/\")) return `${baseUrl}${decodedCallback}`;\n                    else if (new URL(decodedCallback).origin === baseUrl) return decodedCallback;\n                }\n            }\n            // 如果是相对路径，添加baseUrl\n            if (url.startsWith(\"/\")) return `${baseUrl}${url}`;\n            // 如果是同域名的完整URL，直接返回\n            if (new URL(url).origin === baseUrl) return url;\n            // 🎯 默认跳转到tool页面（AI图像去水印工具）\n            return `${baseUrl}/tool`;\n        },\n        async session ({ session, token }) {\n            // 🎯 会话信息处理\n            return session;\n        },\n        async jwt ({ token, user, account }) {\n            // 🎯 JWT token 处理\n            if (user) {\n                token.user = user;\n            }\n            return token;\n        }\n    }\n};\n// 检测用户地理位置的函数\nasync function detectUserLocation() {\n    try {\n        // 这里可以使用IP地理位置检测服务\n        // 暂时返回默认值，实际项目中可以集成 ipapi.co 等服务\n        return \"US\" // 默认为美国\n        ;\n    } catch (error) {\n        console.error(\"地理位置检测失败:\", error);\n        return \"US\";\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBTTtnQkFDUnlGLE1BQU16RixJQUFJLEdBQUdBO1lBQ2Y7WUFDQSxPQUFPeUY7UUFDVDtJQUNGO0FBQ0YsRUFBQztBQUVELGNBQWM7QUFDZCxlQUFlRTtJQUNiLElBQUk7UUFDRixtQkFBbUI7UUFDbkIsaUNBQWlDO1FBQ2pDLE9BQU8sS0FBSyxRQUFROztJQUN0QixFQUFFLE9BQU9qRyxPQUFPO1FBQ2ROLFFBQVFNLEtBQUssQ0FBQyxhQUFhQTtRQUMzQixPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3R1dHUvRGVza3RvcC9CZSBhIERldmVsb3Blci9teS1haS10b29sLXByb2plY3Qvc3JjL2xpYi9hdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDcmVkZW50aWFsc1Byb3ZpZGVyIGZyb20gXCJuZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzXCJcbi8vIGltcG9ydCBHaXRIdWJQcm92aWRlciBmcm9tIFwibmV4dC1hdXRoL3Byb3ZpZGVycy9naXRodWJcIlxuLy8gaW1wb3J0IEdvb2dsZVByb3ZpZGVyIGZyb20gXCJuZXh0LWF1dGgvcHJvdmlkZXJzL2dvb2dsZVwiXG5pbXBvcnQgdHlwZSB7IE5leHRBdXRoT3B0aW9ucyB9IGZyb20gXCJuZXh0LWF1dGhcIlxuaW1wb3J0IHsgZ2V0Q2xpZW50SXAgfSBmcm9tIFwiQC9saWIvdXRpbHMvaXBcIlxuaW1wb3J0IHsgZ2V0SXNvVGltZXN0ciB9IGZyb20gXCJAL2xpYi91dGlscy90aW1lXCJcbmltcG9ydCB7IGdldFV1aWQgfSBmcm9tIFwiQC9saWIvdXRpbHMvaGFzaFwiXG5pbXBvcnQgeyBzYXZlVXNlciB9IGZyb20gXCJAL2xpYi9zZXJ2aWNlcy91c2VyXCJcbmltcG9ydCB7IFVzZXIgfSBmcm9tIFwiQC9saWIvdHlwZXMvdXNlclwiXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5cbmNvbnN0IHByb3ZpZGVyczogYW55W10gPSBbXVxuXG4vLyBHb29nbGUgQXV0aCAo5aaC5p6c6YWN572u5LqGKVxuLy8g5bey56e76ZmkXG5cbi8vIEdpdGh1YiBBdXRoICjlpoLmnpzphY3nva7kuoYpXG4vLyDlt7Lnp7vpmaRcblxuLy8g8J+UpSDnroDljJbnmoTpgq7nrrHnmbvlvZUgLSDlj6rkvb/nlKhTdXBhYmFzZeiupOivgVxuaWYgKHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FVVEhfQ1JFREVOVElBTFNfRU5BQkxFRCA9PT0gXCJ0cnVlXCIpIHtcbiAgcHJvdmlkZXJzLnB1c2goXG4gICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XG4gICAgICBpZDogXCJjcmVkZW50aWFsc1wiLFxuICAgICAgbmFtZTogXCJjcmVkZW50aWFsc1wiLFxuICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgZW1haWw6IHsgbGFiZWw6IFwiRW1haWxcIiwgdHlwZTogXCJlbWFpbFwiIH0sXG4gICAgICAgIHBhc3N3b3JkOiB7IGxhYmVsOiBcIlBhc3N3b3JkXCIsIHR5cGU6IFwicGFzc3dvcmRcIiB9XG4gICAgICB9LFxuICAgICAgYXN5bmMgYXV0aG9yaXplKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIGlmICghY3JlZGVudGlhbHM/LmVtYWlsIHx8ICFjcmVkZW50aWFscz8ucGFzc3dvcmQpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgLy8g8J+OryDlvIDlj5Hnjq/looPmtYvor5XotKbmiLfvvIjml6DpnIDmlbDmja7lupPvvIlcbiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnICYmIFxuICAgICAgICAgICAgY3JlZGVudGlhbHMuZW1haWwgPT09IFwidGVzdEBleGFtcGxlLmNvbVwiICYmIFxuICAgICAgICAgICAgY3JlZGVudGlhbHMucGFzc3dvcmQgPT09IFwicGFzc3dvcmRcIikge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogXCJ0ZXN0LXVzZXItaWRcIixcbiAgICAgICAgICAgIGVtYWlsOiBcInRlc3RAZXhhbXBsZS5jb21cIixcbiAgICAgICAgICAgIG5hbWU6IFwiVGVzdCBVc2VyXCIsXG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8g8J+agCDnlJ/kuqfnjq/looPvvJrkvb/nlKhTdXBhYmFzZeiupOivge+8iOiHquW4pumCrueusemqjOivge+8iVxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIOW8gOWni1N1cGFiYXNl55m75b2V6aqM6K+BOicsIGNyZWRlbnRpYWxzLmVtYWlsKVxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxuICAgICAgICAgICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcbiAgICAgICAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIVxuICAgICAgICAgIClcblxuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFN1cGFiYXNl5a6i5oi356uv5Yib5bu65oiQ5YqfJylcblxuICAgICAgICAgIC8vIPCflJAgU3VwYWJhc2XnmbvlvZXpqozor4HvvIjoh6rliqjmo4Dmn6Xpgq7nrrHpqozor4HnirbmgIHvvIlcbiAgICAgICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25JbldpdGhQYXNzd29yZCh7XG4gICAgICAgICAgICBlbWFpbDogY3JlZGVudGlhbHMuZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogY3JlZGVudGlhbHMucGFzc3dvcmQsXG4gICAgICAgICAgfSlcblxuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFN1cGFiYXNl55m75b2V57uT5p6cOicsIHsgXG4gICAgICAgICAgICBzdWNjZXNzOiAhZXJyb3IsIFxuICAgICAgICAgICAgZXJyb3I6IGVycm9yPy5tZXNzYWdlLFxuICAgICAgICAgICAgdXNlckV4aXN0czogISFkYXRhPy51c2VyLFxuICAgICAgICAgICAgdXNlcklkOiBkYXRhPy51c2VyPy5pZCBcbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAvLyDlpoLmnpzmmK/pgq7nrrHmnKrpqozor4HplJnor6/vvIzlnKjlvIDlj5Hnjq/looPkuIvlhYHorrjnmbvlvZVcbiAgICAgICAgICAgIGlmIChlcnJvci5tZXNzYWdlID09PSAnRW1haWwgbm90IGNvbmZpcm1lZCcgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/CflKcg5byA5Y+R546v5aKD77ya5YWB6K645pyq6aqM6K+B6YKu566x55qE55So5oi355m75b2VJylcbiAgICAgICAgICAgICAgLy8g5bCd6K+V5omL5Yqo56Gu6K6k6YKu566xXG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWRtaW5TdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgICAgICAgICAgICAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgICAgICAgICAgICAgICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyDlhYjmn6Xor6LnlKjmiLdJRFxuICAgICAgICAgICAgICAgIGNvbnN0IHsgZGF0YTogdXNlckRhdGEgfSA9IGF3YWl0IGFkbWluU3VwYWJhc2UuYXV0aC5hZG1pbi5saXN0VXNlcnMoKVxuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFVzZXIgPSB1c2VyRGF0YS51c2Vycy5maW5kKHUgPT4gdS5lbWFpbCA9PT0gY3JlZGVudGlhbHMuZW1haWwpXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldFVzZXIpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHsgZXJyb3I6IGNvbmZpcm1FcnJvciB9ID0gYXdhaXQgYWRtaW5TdXBhYmFzZS5hdXRoLmFkbWluLnVwZGF0ZVVzZXJCeUlkKFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRVc2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICB7IGVtYWlsX2NvbmZpcm06IHRydWUgfVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICBpZiAoIWNvbmZpcm1FcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIOmCrueuseehruiupOaIkOWKn++8jOWFgeiuuOeZu+W9lScpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgaWQ6IHRhcmdldFVzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRhcmdldFVzZXIudXNlcl9tZXRhZGF0YT8ubmFtZSB8fCBjcmVkZW50aWFscy5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBjYXRjaCAoY29uZmlybUVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCDpgq7nrrHnoa7orqTlpLHotKU6JywgY29uZmlybUVycilcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zb2xlLmxvZygn4p2MIOeZu+W9leWksei0pTonLCBlcnJvci5tZXNzYWdlKVxuICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIWRhdGEudXNlcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+KdjCDnlKjmiLfkuI3lrZjlnKgnKVxuICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIOeZu+W9leaIkOWKn++8jOi/lOWbnueUqOaIt+S/oeaBrycpXG4gICAgICAgICAgLy8g8J+OiSDnmbvlvZXmiJDlip9cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQ6IGRhdGEudXNlci5pZCxcbiAgICAgICAgICAgIGVtYWlsOiBkYXRhLnVzZXIuZW1haWwhLFxuICAgICAgICAgICAgbmFtZTogZGF0YS51c2VyLnVzZXJfbWV0YWRhdGE/Lm5hbWUgfHwgZGF0YS51c2VyLmVtYWlsISxcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgU3VwYWJhc2XorqTor4HlvILluLg6JywgZXJyb3IpXG4gICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KVxuICApXG59XG5cbmV4cG9ydCBjb25zdCBwcm92aWRlck1hcCA9IHByb3ZpZGVyc1xuICAubWFwKChwcm92aWRlcjogYW55KSA9PiB7XG4gICAgaWYgKHR5cGVvZiBwcm92aWRlciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBjb25zdCBwcm92aWRlckRhdGEgPSBwcm92aWRlcigpXG4gICAgICByZXR1cm4geyBpZDogcHJvdmlkZXJEYXRhLmlkLCBuYW1lOiBwcm92aWRlckRhdGEubmFtZSB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7IGlkOiBwcm92aWRlci5pZCwgbmFtZTogcHJvdmlkZXIubmFtZSB9XG4gICAgfVxuICB9KVxuXG5leHBvcnQgY29uc3QgYXV0aE9wdGlvbnM6IE5leHRBdXRoT3B0aW9ucyA9IHtcbiAgcHJvdmlkZXJzLFxuICBwYWdlczoge1xuICAgIHNpZ25JbjogXCIvYXV0aC9zaWduaW5cIixcbiAgfSxcbiAgLy8g8J+NqiBDb29raWXlronlhajphY3nva4gLSDkvJjljJbku6XmlK/mjIFHb29nbGUgT25lIFRhcFxuICBjb29raWVzOiB7XG4gICAgc2Vzc2lvblRva2VuOiB7XG4gICAgICBuYW1lOiBgbmV4dC1hdXRoLnNlc3Npb24tdG9rZW5gLFxuICAgICAgb3B0aW9uczoge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6ICdsYXgnLCAgICAgICAgLy8g8J+UpyDorr7nva7kuLpsYXjogIzpnZ5zdHJpY3TvvIzmlK/mjIHnrKzkuInmlrnnmbvlvZVcbiAgICAgICAgcGF0aDogJy8nLFxuICAgICAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicsXG4gICAgICAgIGRvbWFpbjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyA/ICdmbHV4a29udGV4dC5zcGFjZScgOiB1bmRlZmluZWQsIC8vIPCfjJAg5piO56Gu5oyH5a6a5Z+f5ZCNXG4gICAgICB9LFxuICAgIH0sXG4gICAgY2FsbGJhY2tVcmw6IHtcbiAgICAgIG5hbWU6IGBuZXh0LWF1dGguY2FsbGJhY2stdXJsYCxcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgc2FtZVNpdGU6ICdsYXgnLCAgICAgICAgLy8g8J+UpyDmlK/mjIHot6jnq5nngrnlm57osINcbiAgICAgICAgcGF0aDogJy8nLFxuICAgICAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicsXG4gICAgICAgIGRvbWFpbjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyA/ICdmbHV4a29udGV4dC5zcGFjZScgOiB1bmRlZmluZWQsXG4gICAgICB9LFxuICAgIH0sXG4gICAgY3NyZlRva2VuOiB7XG4gICAgICBuYW1lOiBgbmV4dC1hdXRoLmNzcmYtdG9rZW5gLFxuICAgICAgb3B0aW9uczoge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2FtZVNpdGU6ICdsYXgnLCAgICAgICAgLy8g8J+UpyDmlK/mjIFDU1JG5L+d5oqk5L2G5YWB6K6456ys5LiJ5pa555m75b2VXG4gICAgICAgIHBhdGg6ICcvJyxcbiAgICAgICAgc2VjdXJlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nLFxuICAgICAgICBkb21haW46IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgPyAnZmx1eGtvbnRleHQuc3BhY2UnIDogdW5kZWZpbmVkLFxuICAgICAgfSxcbiAgICB9LFxuICAgIC8vIPCflKcg5re75Yqg54q25oCBQ29va2ll6YWN572u5Lul5pSv5oyBR29vZ2xlIE9uZSBUYXBcbiAgICBzdGF0ZToge1xuICAgICAgbmFtZTogYG5leHQtYXV0aC5zdGF0ZWAsXG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICBzYW1lU2l0ZTogJ2xheCcsXG4gICAgICAgIHBhdGg6ICcvJyxcbiAgICAgICAgc2VjdXJlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nLFxuICAgICAgICBtYXhBZ2U6IDkwMCwgLy8gMTXliIbpkp9cbiAgICAgICAgZG9tYWluOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nID8gJ2ZsdXhrb250ZXh0LnNwYWNlJyA6IHVuZGVmaW5lZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBwa2NlQ29kZVZlcmlmaWVyOiB7XG4gICAgICBuYW1lOiBgbmV4dC1hdXRoLnBrY2UuY29kZV92ZXJpZmllcmAsXG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgICBzYW1lU2l0ZTogJ2xheCcsXG4gICAgICAgIHBhdGg6ICcvJyxcbiAgICAgICAgc2VjdXJlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nLFxuICAgICAgICBtYXhBZ2U6IDkwMCwgLy8gMTXliIbpkp9cbiAgICAgICAgZG9tYWluOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nID8gJ2ZsdXhrb250ZXh0LnNwYWNlJyA6IHVuZGVmaW5lZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSxcbiAgY2FsbGJhY2tzOiB7XG4gICAgYXN5bmMgc2lnbkluKHsgdXNlciwgYWNjb3VudCwgcHJvZmlsZSB9KSB7XG4gICAgICAvLyDwn46vIOWkhOeQhueUqOaIt+eZu+W9leWSjOmmluasoeazqOWGjOi1oOmAgeenr+WIhlxuICAgICAgY29uc29sZS5sb2coJ/CflI0gc2lnbklu5Zue6LCD6Kem5Y+ROicsIHsgXG4gICAgICAgIHVzZXI6IHVzZXIsIFxuICAgICAgICBhY2NvdW50OiBhY2NvdW50Py5wcm92aWRlciwgXG4gICAgICAgIHByb2ZpbGU6IHByb2ZpbGU/LmVtYWlsIFxuICAgICAgfSlcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKHVzZXI/LmVtYWlsKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ/CflI0g5byA5aeL5aSE55CG55So5oi3OicsIHVzZXIuZW1haWwpXG4gICAgICAgICAgXG4gICAgICAgICAgLy8g8J+UpyDkvb/nlKhTdXBhYmFzZeabv+S7o1ByaXNtYe+8jOehruS/neaVsOaNruW6k+iuv+mXruS4gOiHtOaAp1xuICAgICAgICAgIGNvbnN0IHsgY3JlYXRlQWRtaW5DbGllbnQgfSA9IGF3YWl0IGltcG9ydCgnQC9saWIvc3VwYWJhc2Uvc2VydmVyJylcbiAgICAgICAgICBjb25zdCB7IGdldFV1aWQgfSA9IGF3YWl0IGltcG9ydCgnQC9saWIvdXRpbHMvaGFzaCcpXG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coJ/CflI0gU3VwYWJhc2XmqKHlnZflr7zlhaXmiJDlip8nKVxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQWRtaW5DbGllbnQoKVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIOajgOafpeeUqOaIt+aYr+WQpuW3suWtmOWcqFxuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIOafpeivoueOsOacieeUqOaIty4uLicpXG4gICAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ1VzZXIsIGVycm9yOiBmaW5kRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAgICAgICAuZXEoJ2VtYWlsJywgdXNlci5lbWFpbClcbiAgICAgICAgICAgIC5saW1pdCgxKVxuICAgICAgICAgICAgLnNpbmdsZSgpXG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coJ/CflI0g5p+l6K+i57uT5p6cOicsIGV4aXN0aW5nVXNlciA/ICfnlKjmiLflt7LlrZjlnKgnIDogJ+eUqOaIt+S4jeWtmOWcqCcpXG5cbiAgICAgICAgICBpZiAoZmluZEVycm9yICYmIGZpbmRFcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgICAgICAvLyDnlKjmiLfkuI3lrZjlnKjvvIzliJvlu7rmlrDnlKjmiLdcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn46BIOW8gOWni+WIm+W7uuaWsOeUqOaIty4uLicpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG5ld1VzZXJEYXRhID0ge1xuICAgICAgICAgICAgICBpZDogdXNlci5pZCB8fCBnZXRVdWlkKCksXG4gICAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgICBuYW1lOiB1c2VyLm5hbWUgfHwgdXNlci5lbWFpbCxcbiAgICAgICAgICAgICAgaW1hZ2U6IHVzZXIuaW1hZ2UgfHwgJycsXG4gICAgICAgICAgICAgIGNyZWRpdHM6IDEwMCwgLy8g8J+OgSDmlrDnlKjmiLfotaDpgIExMDDnp6/liIZcbiAgICAgICAgICAgICAgc2lnbmluX3R5cGU6IGFjY291bnQ/LnR5cGUgfHwgJ29hdXRoJyxcbiAgICAgICAgICAgICAgc2lnbmluX3Byb3ZpZGVyOiBhY2NvdW50Py5wcm92aWRlciB8fCAnZ29vZ2xlJyxcbiAgICAgICAgICAgICAgc2lnbmluX29wZW5pZDogYWNjb3VudD8ucHJvdmlkZXJBY2NvdW50SWQgfHwgJycsXG4gICAgICAgICAgICAgIHNpZ25pbl9pcDogJ3Vua25vd24nLFxuICAgICAgICAgICAgICBsYXN0X3NpZ25pbl9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICBzaWduaW5fY291bnQ6IDEsXG4gICAgICAgICAgICAgIGxvY2F0aW9uOiAnVVMnLFxuICAgICAgICAgICAgICBwcmVmZXJyZWRfY3VycmVuY3k6ICdVU0QnLFxuICAgICAgICAgICAgICBwcmVmZXJyZWRfcGF5bWVudF9wcm92aWRlcjogJ2NyZWVtJ1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCB7IGRhdGE6IG5ld1VzZXIsIGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgICAgICAgICAgLmluc2VydChuZXdVc2VyRGF0YSlcbiAgICAgICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgICAgIC5zaW5nbGUoKVxuXG4gICAgICAgICAgICBpZiAoY3JlYXRlRXJyb3IpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign8J+aqCDmlrDnlKjmiLfliJvlu7rlpLHotKU6JywgY3JlYXRlRXJyb3IpXG4gICAgICAgICAgICAgIC8vIOWNs+S9v+WIm+W7uuWksei0pe+8jOS5n+WFgeiuuOeUqOaIt+eZu+W9le+8jOWQjue7remAmui/h0FQSeiHquWKqOWIm+W7ulxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfjokg5paw55So5oi35Yib5bu65oiQ5YqfOicsIG5ld1VzZXIuaWQpXG5cbiAgICAgICAgICAgICAgLy8g8J+OgSDliJvlu7rnp6/liIbotaDpgIHorrDlvZVcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgICAgICAgLmZyb20oJ2NyZWRpdF90cmFuc2FjdGlvbnMnKVxuICAgICAgICAgICAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBnZXRVdWlkKCksXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfaWQ6IG5ld1VzZXIuaWQsXG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogMTAwLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ2lmdCcsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAn5paw55So5oi35rOo5YaM6LWg6YCB56ev5YiGJyxcbiAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlX2lkOiAnd2VsY29tZV9ib251cydcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYPCfjoEg5paw55So5oi35rOo5YaM5oiQ5Yqf77yM6LWg6YCBMTAw56ev5YiGOiAke3VzZXIuZW1haWx9YClcbiAgICAgICAgICAgICAgfSBjYXRjaCAoY3JlZGl0RXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfimqDvuI8g56ev5YiG6K6w5b2V5Yib5bu65aSx6LSlOicsIGNyZWRpdEVycm9yKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICghZmluZEVycm9yICYmIGV4aXN0aW5nVXNlcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ/CflIQg5pu05paw546w5pyJ55So5oi355m75b2V5L+h5oGvLi4uJylcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8g8J+UhCDnjrDmnInnlKjmiLfvvJrmm7TmlrDnmbvlvZXkv6Hmga9cbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7XG4gICAgICAgICAgICAgIGxhc3Rfc2lnbmluX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgIHNpZ25pbl9jb3VudDogKGV4aXN0aW5nVXNlci5zaWduaW5fY291bnQgfHwgMCkgKyAxLFxuICAgICAgICAgICAgICAvLyDmm7TmlrDlpLTlg4/lkozmmLXnp7DvvIjlpoLmnpzmnInlj5jljJbvvIlcbiAgICAgICAgICAgICAgLi4uKHVzZXIuaW1hZ2UgJiYgeyBpbWFnZTogdXNlci5pbWFnZSB9KSxcbiAgICAgICAgICAgICAgLi4uKHVzZXIubmFtZSAmJiB7IG5hbWU6IHVzZXIubmFtZSB9KSxcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgICAgICAgICAgLnVwZGF0ZSh1cGRhdGVEYXRhKVxuICAgICAgICAgICAgICAuZXEoJ2lkJywgZXhpc3RpbmdVc2VyLmlkKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIOeOsOacieeUqOaIt+eZu+W9leS/oeaBr+abtOaWsOWujOaIkCcpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ/Cfmqgg5pWw5o2u5bqT5p+l6K+i5byC5bi4OicsIGZpbmRFcnJvcilcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KaoO+4jyDnlKjmiLfpgq7nrrHkuLrnqbrvvIzot7Pov4fmlbDmja7lupPmk43kvZwnKVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwg55So5oi355m75b2V5aSE55CG5aSx6LSlOicsIGVycm9yKVxuICAgICAgICAvLyDljbPkvb/mlbDmja7lupPmk43kvZzlpLHotKXvvIzkuZ/lhYHorrjnlKjmiLfnmbvlvZVcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ+KchSBzaWduSW7lm57osIPlrozmiJDvvIzov5Tlm550cnVlJylcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSxcbiAgICBhc3luYyByZWRpcmVjdCh7IHVybCwgYmFzZVVybCB9KSB7XG4gICAgICAvLyDwn46vIOS/ruaUuemHjeWumuWQkemAu+i+kSAtIOS8mOWFiOi3s+i9rOWIsHRvb2zpobXpnaLvvIhBSeWbvuWDj+WOu+awtOWNsOW3peWFt++8iVxuICAgICAgXG4gICAgICAvLyDlpoLmnpxVUkzljIXlkKtjYWxsYmFja1VybOWPguaVsO+8jOS9v+eUqOivpeWPguaVsFxuICAgICAgaWYgKHVybC5pbmNsdWRlcygnY2FsbGJhY2tVcmw9JykpIHtcbiAgICAgICAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh1cmwuc3BsaXQoJz8nKVsxXSlcbiAgICAgICAgY29uc3QgY2FsbGJhY2tVcmwgPSB1cmxQYXJhbXMuZ2V0KCdjYWxsYmFja1VybCcpXG4gICAgICAgIGlmIChjYWxsYmFja1VybCkge1xuICAgICAgICAgIC8vIOino+eggWNhbGxiYWNrVXJsXG4gICAgICAgICAgY29uc3QgZGVjb2RlZENhbGxiYWNrID0gZGVjb2RlVVJJQ29tcG9uZW50KGNhbGxiYWNrVXJsKVxuICAgICAgICAgIGlmIChkZWNvZGVkQ2FsbGJhY2suc3RhcnRzV2l0aChcIi9cIikpIHJldHVybiBgJHtiYXNlVXJsfSR7ZGVjb2RlZENhbGxiYWNrfWBcbiAgICAgICAgICBlbHNlIGlmIChuZXcgVVJMKGRlY29kZWRDYWxsYmFjaykub3JpZ2luID09PSBiYXNlVXJsKSByZXR1cm4gZGVjb2RlZENhbGxiYWNrXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8g5aaC5p6c5piv55u45a+56Lev5b6E77yM5re75YqgYmFzZVVybFxuICAgICAgaWYgKHVybC5zdGFydHNXaXRoKFwiL1wiKSkgcmV0dXJuIGAke2Jhc2VVcmx9JHt1cmx9YFxuICAgICAgXG4gICAgICAvLyDlpoLmnpzmmK/lkIzln5/lkI3nmoTlrozmlbRVUkzvvIznm7TmjqXov5Tlm55cbiAgICAgIGlmIChuZXcgVVJMKHVybCkub3JpZ2luID09PSBiYXNlVXJsKSByZXR1cm4gdXJsXG4gICAgICBcbiAgICAgIC8vIPCfjq8g6buY6K6k6Lez6L2s5YiwdG9vbOmhtemdou+8iEFJ5Zu+5YOP5Y675rC05Y2w5bel5YW377yJXG4gICAgICByZXR1cm4gYCR7YmFzZVVybH0vdG9vbGBcbiAgICB9LFxuICAgIGFzeW5jIHNlc3Npb24oeyBzZXNzaW9uLCB0b2tlbiB9KSB7XG4gICAgICAvLyDwn46vIOS8muivneS/oeaBr+WkhOeQhlxuICAgICAgcmV0dXJuIHNlc3Npb25cbiAgICB9LFxuICAgIGFzeW5jIGp3dCh7IHRva2VuLCB1c2VyLCBhY2NvdW50IH06IHsgdG9rZW46IGFueTsgdXNlcj86IGFueTsgYWNjb3VudD86IGFueSB9KSB7XG4gICAgICAvLyDwn46vIEpXVCB0b2tlbiDlpITnkIZcbiAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgIHRva2VuLnVzZXIgPSB1c2VyIGFzIGFueVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRva2VuXG4gICAgfSxcbiAgfSxcbn1cblxuLy8g5qOA5rWL55So5oi35Zyw55CG5L2N572u55qE5Ye95pWwXG5hc3luYyBmdW5jdGlvbiBkZXRlY3RVc2VyTG9jYXRpb24oKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgdHJ5IHtcbiAgICAvLyDov5nph4zlj6/ku6Xkvb/nlKhJUOWcsOeQhuS9jee9ruajgOa1i+acjeWKoVxuICAgIC8vIOaaguaXtui/lOWbnum7mOiupOWAvO+8jOWunumZhemhueebruS4reWPr+S7pembhuaIkCBpcGFwaS5jbyDnrYnmnI3liqFcbiAgICByZXR1cm4gXCJVU1wiIC8vIOm7mOiupOS4uue+juWbvVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCLlnLDnkIbkvY3nva7mo4DmtYvlpLHotKU6XCIsIGVycm9yKVxuICAgIHJldHVybiBcIlVTXCJcbiAgfVxufSAiXSwibmFtZXMiOlsiQ3JlZGVudGlhbHNQcm92aWRlciIsImNyZWF0ZUNsaWVudCIsInByb3ZpZGVycyIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19BVVRIX0NSRURFTlRJQUxTX0VOQUJMRUQiLCJwdXNoIiwiaWQiLCJuYW1lIiwiY3JlZGVudGlhbHMiLCJlbWFpbCIsImxhYmVsIiwidHlwZSIsInBhc3N3b3JkIiwiYXV0aG9yaXplIiwiY29uc29sZSIsImxvZyIsInN1cGFiYXNlIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJkYXRhIiwiZXJyb3IiLCJhdXRoIiwic2lnbkluV2l0aFBhc3N3b3JkIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJ1c2VyRXhpc3RzIiwidXNlciIsInVzZXJJZCIsImFkbWluU3VwYWJhc2UiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwidXNlckRhdGEiLCJhZG1pbiIsImxpc3RVc2VycyIsInRhcmdldFVzZXIiLCJ1c2VycyIsImZpbmQiLCJ1IiwiY29uZmlybUVycm9yIiwidXBkYXRlVXNlckJ5SWQiLCJlbWFpbF9jb25maXJtIiwidXNlcl9tZXRhZGF0YSIsImNvbmZpcm1FcnIiLCJwcm92aWRlck1hcCIsIm1hcCIsInByb3ZpZGVyIiwicHJvdmlkZXJEYXRhIiwiYXV0aE9wdGlvbnMiLCJwYWdlcyIsInNpZ25JbiIsImNvb2tpZXMiLCJzZXNzaW9uVG9rZW4iLCJvcHRpb25zIiwiaHR0cE9ubHkiLCJzYW1lU2l0ZSIsInBhdGgiLCJzZWN1cmUiLCJkb21haW4iLCJ1bmRlZmluZWQiLCJjYWxsYmFja1VybCIsImNzcmZUb2tlbiIsInN0YXRlIiwibWF4QWdlIiwicGtjZUNvZGVWZXJpZmllciIsImNhbGxiYWNrcyIsImFjY291bnQiLCJwcm9maWxlIiwiY3JlYXRlQWRtaW5DbGllbnQiLCJnZXRVdWlkIiwiZXhpc3RpbmdVc2VyIiwiZmluZEVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwibGltaXQiLCJzaW5nbGUiLCJjb2RlIiwibmV3VXNlckRhdGEiLCJpbWFnZSIsImNyZWRpdHMiLCJzaWduaW5fdHlwZSIsInNpZ25pbl9wcm92aWRlciIsInNpZ25pbl9vcGVuaWQiLCJwcm92aWRlckFjY291bnRJZCIsInNpZ25pbl9pcCIsImxhc3Rfc2lnbmluX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic2lnbmluX2NvdW50IiwibG9jYXRpb24iLCJwcmVmZXJyZWRfY3VycmVuY3kiLCJwcmVmZXJyZWRfcGF5bWVudF9wcm92aWRlciIsIm5ld1VzZXIiLCJjcmVhdGVFcnJvciIsImluc2VydCIsInVzZXJfaWQiLCJhbW91bnQiLCJkZXNjcmlwdGlvbiIsInJlZmVyZW5jZV9pZCIsImNyZWRpdEVycm9yIiwidXBkYXRlRGF0YSIsInVwZGF0ZSIsInJlZGlyZWN0IiwidXJsIiwiYmFzZVVybCIsImluY2x1ZGVzIiwidXJsUGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwic3BsaXQiLCJnZXQiLCJkZWNvZGVkQ2FsbGJhY2siLCJkZWNvZGVVUklDb21wb25lbnQiLCJzdGFydHNXaXRoIiwiVVJMIiwib3JpZ2luIiwic2Vzc2lvbiIsInRva2VuIiwiand0IiwiZGV0ZWN0VXNlckxvY2F0aW9uIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/replicate.ts":
/*!******************************!*\
  !*** ./src/lib/replicate.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   callReplicateAPI: () => (/* binding */ callReplicateAPI)\n/* harmony export */ });\n// 该文件封装与Replicate API的真实交互逻辑，支持不同功能调用不同模型\n// 通过环境变量安全读取API Token\nconst REPLICATE_API_TOKEN = process.env.REPLICATE_API_TOKEN;\n// Replicate模型配置，按功能区分\nconst models = {\n    remove: {\n        // flux-kontext-apps/text-removal\n        version: \"e28636410bff2b083e38f4e856a5b2be171c8bb6636f527b1a9e84dff29d1c54\",\n        modelInput: (base64)=>({\n                input_image: `data:image/png;base64,${base64}`\n            })\n    },\n    enhance: {\n        // flux-kontext-apps/restore-image\n        version: \"85ae46551612b8f778348846b6ce1ce1b340e384fe2062399c0c412be29e107d\",\n        modelInput: (base64)=>({\n                input_image: `data:image/png;base64,${base64}`\n            })\n    }\n};\n// 通用AI图片处理函数\nasync function callReplicateAPI(action, file) {\n    if (!REPLICATE_API_TOKEN) {\n        console.log('⚠️ Replicate API token not set, using mock processing for development');\n        // 开发环境：模拟处理，返回原图\n        return new Promise((resolve)=>{\n            const reader = new FileReader();\n            reader.onload = ()=>{\n                // 返回原图的 data URL\n                resolve(reader.result);\n            };\n            reader.readAsDataURL(file);\n        });\n    }\n    const model = models[action];\n    if (!model) throw new Error('Unknown action');\n    // 读取图片为base64\n    const arrayBuffer = await file.arrayBuffer();\n    const base64 = Buffer.from(arrayBuffer).toString('base64');\n    // 调试日志：打印模型和请求体\n    console.log('[Replicate] 调用模型:', model.version);\n    console.log('[Replicate] 请求input:', model.modelInput(base64));\n    // 1. 创建预测任务\n    const res = await fetch('https://api.replicate.com/v1/predictions', {\n        method: 'POST',\n        headers: {\n            'Authorization': `Token ${REPLICATE_API_TOKEN}`,\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            version: model.version,\n            input: model.modelInput(base64)\n        })\n    });\n    if (!res.ok) {\n        const err = await res.text();\n        console.error('[Replicate] 创建预测失败:', err);\n        throw new Error('Failed to create prediction: ' + err);\n    }\n    const data = await res.json();\n    let prediction = data;\n    // 2. 轮询获取结果\n    while(prediction.status !== 'succeeded' && prediction.status !== 'failed'){\n        await new Promise((r)=>setTimeout(r, 1500));\n        const pollRes = await fetch(`https://api.replicate.com/v1/predictions/${prediction.id}`, {\n            headers: {\n                'Authorization': `Token ${REPLICATE_API_TOKEN}`\n            }\n        });\n        prediction = await pollRes.json();\n        console.log('[Replicate] 轮询状态:', prediction.status);\n    }\n    if (prediction.status === 'succeeded') {\n        // 返回图片URL（部分模型为数组，部分为字符串）\n        console.log('[Replicate] 处理成功，输出:', prediction.output);\n        if (Array.isArray(prediction.output)) return prediction.output[0];\n        return prediction.output;\n    }\n    console.error('[Replicate] 处理失败:', prediction.error || prediction);\n    throw new Error('Replicate AI failed: ' + (prediction.error || 'Unknown error'));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQ2pFLE9BQU9OLFdBQVdNLE1BQU07SUFDMUI7SUFDQW5DLFFBQVEwQixLQUFLLENBQUMscUJBQXFCRyxXQUFXSCxLQUFLLElBQUlHO0lBQ3ZELE1BQU0sSUFBSW5CLE1BQU0sMEJBQTJCbUIsQ0FBQUEsV0FBV0gsS0FBSyxJQUFJLGVBQWM7QUFDL0UiLCJzb3VyY2VzIjpbIi9Vc2Vycy90dXR1L0Rlc2t0b3AvQmUgYSBEZXZlbG9wZXIvbXktYWktdG9vbC1wcm9qZWN0L3NyYy9saWIvcmVwbGljYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIOivpeaWh+S7tuWwgeijheS4jlJlcGxpY2F0ZSBBUEnnmoTnnJ/lrp7kuqTkupLpgLvovpHvvIzmlK/mjIHkuI3lkIzlip/og73osIPnlKjkuI3lkIzmqKHlnotcbi8vIOmAmui/h+eOr+Wig+WPmOmHj+WuieWFqOivu+WPlkFQSSBUb2tlblxuXG5jb25zdCBSRVBMSUNBVEVfQVBJX1RPS0VOID0gcHJvY2Vzcy5lbnYuUkVQTElDQVRFX0FQSV9UT0tFTlxuXG4vLyBSZXBsaWNhdGXmqKHlnovphY3nva7vvIzmjInlip/og73ljLrliIZcbmNvbnN0IG1vZGVscyA9IHtcbiAgcmVtb3ZlOiB7XG4gICAgLy8gZmx1eC1rb250ZXh0LWFwcHMvdGV4dC1yZW1vdmFsXG4gICAgdmVyc2lvbjogXCJlMjg2MzY0MTBiZmYyYjA4M2UzOGY0ZTg1NmE1YjJiZTE3MWM4YmI2NjM2ZjUyN2IxYTllODRkZmYyOWQxYzU0XCIsXG4gICAgbW9kZWxJbnB1dDogKGJhc2U2NDogc3RyaW5nKSA9PiAoeyBpbnB1dF9pbWFnZTogYGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwke2Jhc2U2NH1gIH0pXG4gIH0sXG4gIGVuaGFuY2U6IHtcbiAgICAvLyBmbHV4LWtvbnRleHQtYXBwcy9yZXN0b3JlLWltYWdlXG4gICAgdmVyc2lvbjogXCI4NWFlNDY1NTE2MTJiOGY3NzgzNDg4NDZiNmNlMWNlMWIzNDBlMzg0ZmUyMDYyMzk5YzBjNDEyYmUyOWUxMDdkXCIsXG4gICAgbW9kZWxJbnB1dDogKGJhc2U2NDogc3RyaW5nKSA9PiAoeyBpbnB1dF9pbWFnZTogYGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwke2Jhc2U2NH1gIH0pXG4gIH0sXG4gIC8vIHR1bmU6IC4uLu+8iOWmguacieW+ruiwg+aooeWei+WPr+ihpeWFhe+8iVxufVxuXG4vLyDpgJrnlKhBSeWbvueJh+WkhOeQhuWHveaVsFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNhbGxSZXBsaWNhdGVBUEkoYWN0aW9uOiAncmVtb3ZlJyB8ICdlbmhhbmNlJywgZmlsZTogRmlsZSk6IFByb21pc2U8c3RyaW5nPiB7XG4gIGlmICghUkVQTElDQVRFX0FQSV9UT0tFTikge1xuICAgIGNvbnNvbGUubG9nKCfimqDvuI8gUmVwbGljYXRlIEFQSSB0b2tlbiBub3Qgc2V0LCB1c2luZyBtb2NrIHByb2Nlc3NpbmcgZm9yIGRldmVsb3BtZW50JylcbiAgICAvLyDlvIDlj5Hnjq/looPvvJrmqKHmi5/lpITnkIbvvIzov5Tlm57ljp/lm75cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKClcbiAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIC8vIOi/lOWbnuWOn+WbvueahCBkYXRhIFVSTFxuICAgICAgICByZXNvbHZlKHJlYWRlci5yZXN1bHQgYXMgc3RyaW5nKVxuICAgICAgfVxuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSlcbiAgICB9KVxuICB9XG4gIFxuICBjb25zdCBtb2RlbCA9IG1vZGVsc1thY3Rpb25dXG4gIGlmICghbW9kZWwpIHRocm93IG5ldyBFcnJvcignVW5rbm93biBhY3Rpb24nKVxuXG4gIC8vIOivu+WPluWbvueJh+S4umJhc2U2NFxuICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKVxuICBjb25zdCBiYXNlNjQgPSBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlcikudG9TdHJpbmcoJ2Jhc2U2NCcpXG5cbiAgLy8g6LCD6K+V5pel5b+X77ya5omT5Y2w5qih5Z6L5ZKM6K+35rGC5L2TXG4gIGNvbnNvbGUubG9nKCdbUmVwbGljYXRlXSDosIPnlKjmqKHlnos6JywgbW9kZWwudmVyc2lvbilcbiAgY29uc29sZS5sb2coJ1tSZXBsaWNhdGVdIOivt+axgmlucHV0OicsIG1vZGVsLm1vZGVsSW5wdXQoYmFzZTY0KSlcblxuICAvLyAxLiDliJvlu7rpooTmtYvku7vliqFcbiAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLnJlcGxpY2F0ZS5jb20vdjEvcHJlZGljdGlvbnMnLCB7XG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgaGVhZGVyczoge1xuICAgICAgJ0F1dGhvcml6YXRpb24nOiBgVG9rZW4gJHtSRVBMSUNBVEVfQVBJX1RPS0VOfWAsXG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICB2ZXJzaW9uOiBtb2RlbC52ZXJzaW9uLFxuICAgICAgaW5wdXQ6IG1vZGVsLm1vZGVsSW5wdXQoYmFzZTY0KVxuICAgIH0pXG4gIH0pXG4gIGlmICghcmVzLm9rKSB7XG4gICAgY29uc3QgZXJyID0gYXdhaXQgcmVzLnRleHQoKVxuICAgIGNvbnNvbGUuZXJyb3IoJ1tSZXBsaWNhdGVdIOWIm+W7uumihOa1i+Wksei0pTonLCBlcnIpXG4gICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIHByZWRpY3Rpb246ICcgKyBlcnIpXG4gIH1cbiAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKClcbiAgbGV0IHByZWRpY3Rpb24gPSBkYXRhXG5cbiAgLy8gMi4g6L2u6K+i6I635Y+W57uT5p6cXG4gIHdoaWxlIChwcmVkaWN0aW9uLnN0YXR1cyAhPT0gJ3N1Y2NlZWRlZCcgJiYgcHJlZGljdGlvbi5zdGF0dXMgIT09ICdmYWlsZWQnKSB7XG4gICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDE1MDApKVxuICAgIGNvbnN0IHBvbGxSZXMgPSBhd2FpdCBmZXRjaChgaHR0cHM6Ly9hcGkucmVwbGljYXRlLmNvbS92MS9wcmVkaWN0aW9ucy8ke3ByZWRpY3Rpb24uaWR9YCwge1xuICAgICAgaGVhZGVyczogeyAnQXV0aG9yaXphdGlvbic6IGBUb2tlbiAke1JFUExJQ0FURV9BUElfVE9LRU59YCB9XG4gICAgfSlcbiAgICBwcmVkaWN0aW9uID0gYXdhaXQgcG9sbFJlcy5qc29uKClcbiAgICBjb25zb2xlLmxvZygnW1JlcGxpY2F0ZV0g6L2u6K+i54q25oCBOicsIHByZWRpY3Rpb24uc3RhdHVzKVxuICB9XG4gIGlmIChwcmVkaWN0aW9uLnN0YXR1cyA9PT0gJ3N1Y2NlZWRlZCcpIHtcbiAgICAvLyDov5Tlm57lm77niYdVUkzvvIjpg6jliIbmqKHlnovkuLrmlbDnu4TvvIzpg6jliIbkuLrlrZfnrKbkuLLvvIlcbiAgICBjb25zb2xlLmxvZygnW1JlcGxpY2F0ZV0g5aSE55CG5oiQ5Yqf77yM6L6T5Ye6OicsIHByZWRpY3Rpb24ub3V0cHV0KVxuICAgIGlmIChBcnJheS5pc0FycmF5KHByZWRpY3Rpb24ub3V0cHV0KSkgcmV0dXJuIHByZWRpY3Rpb24ub3V0cHV0WzBdXG4gICAgcmV0dXJuIHByZWRpY3Rpb24ub3V0cHV0XG4gIH1cbiAgY29uc29sZS5lcnJvcignW1JlcGxpY2F0ZV0g5aSE55CG5aSx6LSlOicsIHByZWRpY3Rpb24uZXJyb3IgfHwgcHJlZGljdGlvbilcbiAgdGhyb3cgbmV3IEVycm9yKCdSZXBsaWNhdGUgQUkgZmFpbGVkOiAnICsgKHByZWRpY3Rpb24uZXJyb3IgfHwgJ1Vua25vd24gZXJyb3InKSlcbn0gIl0sIm5hbWVzIjpbIlJFUExJQ0FURV9BUElfVE9LRU4iLCJwcm9jZXNzIiwiZW52IiwibW9kZWxzIiwicmVtb3ZlIiwidmVyc2lvbiIsIm1vZGVsSW5wdXQiLCJiYXNlNjQiLCJpbnB1dF9pbWFnZSIsImVuaGFuY2UiLCJjYWxsUmVwbGljYXRlQVBJIiwiYWN0aW9uIiwiZmlsZSIsImNvbnNvbGUiLCJsb2ciLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJyZXN1bHQiLCJyZWFkQXNEYXRhVVJMIiwibW9kZWwiLCJFcnJvciIsImFycmF5QnVmZmVyIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwicmVzIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJpbnB1dCIsIm9rIiwiZXJyIiwidGV4dCIsImVycm9yIiwiZGF0YSIsImpzb24iLCJwcmVkaWN0aW9uIiwic3RhdHVzIiwiciIsInNldFRpbWVvdXQiLCJwb2xsUmVzIiwiaWQiLCJvdXRwdXQiLCJBcnJheSIsImlzQXJyYXkiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/replicate.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/next-auth","vendor-chunks/@babel","vendor-chunks/tr46","vendor-chunks/jose","vendor-chunks/openid-client","vendor-chunks/whatwg-url","vendor-chunks/oauth","vendor-chunks/preact","vendor-chunks/yallist","vendor-chunks/preact-render-to-string","vendor-chunks/cookie","vendor-chunks/webidl-conversions","vendor-chunks/oidc-token-hash","vendor-chunks/@panva"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fenhance-image%2Froute&page=%2Fapi%2Fenhance-image%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fenhance-image%2Froute.ts&appDir=%2FUsers%2Ftutu%2FDesktop%2FBe%20a%20Developer%2Fmy-ai-tool-project%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ftutu%2FDesktop%2FBe%20a%20Developer%2Fmy-ai-tool-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();