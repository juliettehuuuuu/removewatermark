"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n\n// 简单的内存速率限制器 (生产环境建议使用Redis)\nconst rateLimitMap = new Map();\nfunction rateLimit(ip, limit = 10, windowMs = 60000) {\n    const now = Date.now();\n    const windowStart = now - windowMs;\n    const record = rateLimitMap.get(ip);\n    if (!record || record.lastReset < windowStart) {\n        rateLimitMap.set(ip, {\n            count: 1,\n            lastReset: now\n        });\n        return true;\n    }\n    if (record.count >= limit) {\n        return false;\n    }\n    record.count++;\n    return true;\n}\n// 🔐 安全检查函数\nfunction performSecurityChecks(request) {\n    const url = new URL(request.url);\n    const userAgent = request.headers.get('user-agent') || '';\n    // 检查可疑的User-Agent\n    const suspiciousUserAgents = [\n        /bot/i,\n        /crawler/i,\n        /spider/i,\n        /scraper/i,\n        /curl/i,\n        /wget/i\n    ];\n    if (suspiciousUserAgents.some((pattern)=>pattern.test(userAgent))) {\n        return {\n            allowed: false,\n            reason: 'Suspicious User-Agent'\n        };\n    }\n    // 检查路径遍历攻击\n    if (url.pathname.includes('..') || url.pathname.includes('\\\\')) {\n        return {\n            allowed: false,\n            reason: 'Path traversal attempt'\n        };\n    }\n    // 检查SQL注入模式\n    const sqlInjectionPatterns = [\n        /union.*select/i,\n        /drop.*table/i,\n        /insert.*into/i,\n        /delete.*from/i,\n        /update.*set/i\n    ];\n    if (sqlInjectionPatterns.some((pattern)=>pattern.test(url.pathname) || pattern.test(url.search))) {\n        return {\n            allowed: false,\n            reason: 'SQL injection attempt'\n        };\n    }\n    // 检查XSS攻击\n    const xssPatterns = [\n        /<script/i,\n        /javascript:/i,\n        /vbscript:/i,\n        /on\\w+\\s*=/i\n    ];\n    if (xssPatterns.some((pattern)=>pattern.test(url.pathname) || pattern.test(url.search))) {\n        return {\n            allowed: false,\n            reason: 'XSS attempt'\n        };\n    }\n    return {\n        allowed: true\n    };\n}\nfunction middleware(request) {\n    const { pathname } = request.nextUrl;\n    // 🔐 安全检查\n    const securityCheck = performSecurityChecks(request);\n    if (!securityCheck.allowed) {\n        console.log(`🔒 Security block: ${securityCheck.reason} from ${request.headers.get('x-forwarded-for') || 'unknown'}`);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Request blocked for security reasons'\n        }, {\n            status: 403\n        });\n    }\n    // 强制HTTPS重定向 (生产环境)\n    if (false) {}\n    // API v1 路由重写 - 将文档中的API端点映射到实际实现\n    if (pathname.startsWith('/api/v1/')) {\n        let newPath = '/api/flux-kontext';\n        let action = '';\n        // 根据URL路径确定action类型\n        if (pathname.includes('/text-to-image/pro')) {\n            action = 'text-to-image-pro';\n        } else if (pathname.includes('/text-to-image/max')) {\n            action = 'edit-image-max';\n        } else if (pathname.includes('/image-edit/pro')) {\n            action = 'edit-image-pro';\n        } else if (pathname.includes('/image-edit/max')) {\n            action = 'edit-image-max';\n        }\n        // 创建新的URL并添加action参数\n        const url = request.nextUrl.clone();\n        url.pathname = newPath;\n        // 如果确定了action，添加到查询参数中\n        if (action) {\n            url.searchParams.set('action', action);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.rewrite(url);\n    }\n    const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    // 添加安全头\n    response.headers.set('X-Frame-Options', 'DENY');\n    response.headers.set('X-Content-Type-Options', 'nosniff');\n    response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n    response.headers.set('X-XSS-Protection', '1; mode=block');\n    response.headers.set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');\n    // 🔐 增强的内容安全策略\n    response.headers.set('Content-Security-Policy', \"default-src 'self'; \" + \"script-src 'self' 'unsafe-inline' 'unsafe-eval' \" + \"https://platform.twitter.com \" + \"https://www.googletagmanager.com \" + \"https://accounts.google.com \" + \"https://apis.google.com \" + \"https://www.gstatic.com \" + \"https://gstatic.com \" + \"https://challenges.cloudflare.com \" + \"https://static.cloudflareinsights.com \" + \"data: blob:; \" + \"style-src 'self' 'unsafe-inline' \" + \"https://fonts.googleapis.com \" + \"https://accounts.google.com \" + \"https://www.gstatic.com; \" + \"font-src 'self' \" + \"https://fonts.gstatic.com \" + \"https://accounts.google.com \" + \"data:; \" + \"img-src 'self' data: https: blob:; \" + \"connect-src 'self' https: \" + \"https://accounts.google.com \" + \"https://www.googleapis.com \" + \"https://challenges.cloudflare.com \" + \"wss: ws:; \" + \"frame-src 'self' \" + \"https://accounts.google.com \" + \"https://www.google.com \" + \"https://challenges.cloudflare.com; \" + \"object-src 'none'; \" + \"base-uri 'self'; \" + \"form-action 'self' https:; \" + \"frame-ancestors 'self'; \" + \"upgrade-insecure-requests;\");\n    // 🔐 添加更多安全头\n    response.headers.set('Permissions-Policy', 'camera=(), microphone=(), geolocation=()');\n    response.headers.set('X-DNS-Prefetch-Control', 'off');\n    // API路由速率限制 (仅在生产环境启用)\n    if (false) {}\n    // 🔐 记录可疑请求\n    const suspiciousPatterns = [\n        /\\.\\.\\//,\n        /<script/i,\n        /union.*select/i,\n        /javascript:/i,\n        /on\\w+\\s*=/i // 事件处理器\n    ];\n    const isSuspicious = suspiciousPatterns.some((pattern)=>pattern.test(pathname) || pattern.test(request.nextUrl.search));\n    if (isSuspicious) {\n        console.log(`🔒 Suspicious request detected: ${pathname} from ${request.headers.get('x-forwarded-for') || 'unknown'}`);\n    }\n    return response;\n}\nconst config = {\n    matcher: [\n        '/((?!_next/static|_next/image|favicon.ico).*)'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QSx3Q0FDQSx3QkFDQSxzQkFDQSxnQ0FDQSw2QkFDQTtJQUdGLGFBQWE7SUFDYm9DLFNBQVM3QixPQUFPLENBQUNQLEdBQUcsQ0FBQyxzQkFBc0I7SUFDM0NvQyxTQUFTN0IsT0FBTyxDQUFDUCxHQUFHLENBQUMsMEJBQTBCO0lBRS9DLHVCQUF1QjtJQUN2QixJQUFJMkIsS0FBcUYsRUFBRSxFQTZCMUY7SUFFRCxZQUFZO0lBQ1osTUFBTWMscUJBQXFCO1FBQ3pCO1FBQ0E7UUFDQTtRQUNBO1FBQ0EsYUFBYSxRQUFRO0tBQ3RCO0lBRUQsTUFBTUMsZUFBZUQsbUJBQW1CaEMsSUFBSSxDQUFDQyxDQUFBQSxVQUMzQ0EsUUFBUUMsSUFBSSxDQUFDRyxhQUFhSixRQUFRQyxJQUFJLENBQUNSLFFBQVFpQixPQUFPLENBQUNILE1BQU07SUFHL0QsSUFBSXlCLGNBQWM7UUFDaEJwQixRQUFRQyxHQUFHLENBQUMsQ0FBQyxnQ0FBZ0MsRUFBRVQsU0FBUyxNQUFNLEVBQUVYLFFBQVFJLE9BQU8sQ0FBQ1QsR0FBRyxDQUFDLHNCQUFzQixXQUFXO0lBQ3ZIO0lBRUEsT0FBT3NDO0FBQ1Q7QUFFTyxNQUFNTyxTQUFTO0lBQ3BCQyxTQUFTO1FBQ1A7S0FDRDtBQUNILEVBQUMiLCJzb3VyY2VzIjpbIi9Vc2Vycy90dXR1L0Rlc2t0b3AvQmUgYSBEZXZlbG9wZXIvbXktYWktdG9vbC1wcm9qZWN0L3NyYy9taWRkbGV3YXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcblxuLy8g566A5Y2V55qE5YaF5a2Y6YCf546H6ZmQ5Yi25ZmoICjnlJ/kuqfnjq/looPlu7rorq7kvb/nlKhSZWRpcylcbmNvbnN0IHJhdGVMaW1pdE1hcCA9IG5ldyBNYXA8c3RyaW5nLCB7IGNvdW50OiBudW1iZXI7IGxhc3RSZXNldDogbnVtYmVyIH0+KClcblxuZnVuY3Rpb24gcmF0ZUxpbWl0KGlwOiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSAxMCwgd2luZG93TXM6IG51bWJlciA9IDYwMDAwKTogYm9vbGVhbiB7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KClcbiAgY29uc3Qgd2luZG93U3RhcnQgPSBub3cgLSB3aW5kb3dNc1xuICBcbiAgY29uc3QgcmVjb3JkID0gcmF0ZUxpbWl0TWFwLmdldChpcClcbiAgXG4gIGlmICghcmVjb3JkIHx8IHJlY29yZC5sYXN0UmVzZXQgPCB3aW5kb3dTdGFydCkge1xuICAgIHJhdGVMaW1pdE1hcC5zZXQoaXAsIHsgY291bnQ6IDEsIGxhc3RSZXNldDogbm93IH0pXG4gICAgcmV0dXJuIHRydWVcbiAgfVxuICBcbiAgaWYgKHJlY29yZC5jb3VudCA+PSBsaW1pdCkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG4gIFxuICByZWNvcmQuY291bnQrK1xuICByZXR1cm4gdHJ1ZVxufVxuXG4vLyDwn5SQIOWuieWFqOajgOafpeWHveaVsFxuZnVuY3Rpb24gcGVyZm9ybVNlY3VyaXR5Q2hlY2tzKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogeyBhbGxvd2VkOiBib29sZWFuOyByZWFzb24/OiBzdHJpbmcgfSB7XG4gIGNvbnN0IHVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpXG4gIGNvbnN0IHVzZXJBZ2VudCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKSB8fCAnJ1xuICBcbiAgLy8g5qOA5p+l5Y+v55aR55qEVXNlci1BZ2VudFxuICBjb25zdCBzdXNwaWNpb3VzVXNlckFnZW50cyA9IFtcbiAgICAvYm90L2ksXG4gICAgL2NyYXdsZXIvaSxcbiAgICAvc3BpZGVyL2ksXG4gICAgL3NjcmFwZXIvaSxcbiAgICAvY3VybC9pLFxuICAgIC93Z2V0L2lcbiAgXVxuICBcbiAgaWYgKHN1c3BpY2lvdXNVc2VyQWdlbnRzLnNvbWUocGF0dGVybiA9PiBwYXR0ZXJuLnRlc3QodXNlckFnZW50KSkpIHtcbiAgICByZXR1cm4geyBhbGxvd2VkOiBmYWxzZSwgcmVhc29uOiAnU3VzcGljaW91cyBVc2VyLUFnZW50JyB9XG4gIH1cbiAgXG4gIC8vIOajgOafpei3r+W+hOmBjeWOhuaUu+WHu1xuICBpZiAodXJsLnBhdGhuYW1lLmluY2x1ZGVzKCcuLicpIHx8IHVybC5wYXRobmFtZS5pbmNsdWRlcygnXFxcXCcpKSB7XG4gICAgcmV0dXJuIHsgYWxsb3dlZDogZmFsc2UsIHJlYXNvbjogJ1BhdGggdHJhdmVyc2FsIGF0dGVtcHQnIH1cbiAgfVxuICBcbiAgLy8g5qOA5p+lU1FM5rOo5YWl5qih5byPXG4gIGNvbnN0IHNxbEluamVjdGlvblBhdHRlcm5zID0gW1xuICAgIC91bmlvbi4qc2VsZWN0L2ksXG4gICAgL2Ryb3AuKnRhYmxlL2ksXG4gICAgL2luc2VydC4qaW50by9pLFxuICAgIC9kZWxldGUuKmZyb20vaSxcbiAgICAvdXBkYXRlLipzZXQvaVxuICBdXG4gIFxuICBpZiAoc3FsSW5qZWN0aW9uUGF0dGVybnMuc29tZShwYXR0ZXJuID0+IFxuICAgIHBhdHRlcm4udGVzdCh1cmwucGF0aG5hbWUpIHx8IHBhdHRlcm4udGVzdCh1cmwuc2VhcmNoKVxuICApKSB7XG4gICAgcmV0dXJuIHsgYWxsb3dlZDogZmFsc2UsIHJlYXNvbjogJ1NRTCBpbmplY3Rpb24gYXR0ZW1wdCcgfVxuICB9XG4gIFxuICAvLyDmo4Dmn6VYU1PmlLvlh7tcbiAgY29uc3QgeHNzUGF0dGVybnMgPSBbXG4gICAgLzxzY3JpcHQvaSxcbiAgICAvamF2YXNjcmlwdDovaSxcbiAgICAvdmJzY3JpcHQ6L2ksXG4gICAgL29uXFx3K1xccyo9L2lcbiAgXVxuICBcbiAgaWYgKHhzc1BhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBcbiAgICBwYXR0ZXJuLnRlc3QodXJsLnBhdGhuYW1lKSB8fCBwYXR0ZXJuLnRlc3QodXJsLnNlYXJjaClcbiAgKSkge1xuICAgIHJldHVybiB7IGFsbG93ZWQ6IGZhbHNlLCByZWFzb246ICdYU1MgYXR0ZW1wdCcgfVxuICB9XG4gIFxuICByZXR1cm4geyBhbGxvd2VkOiB0cnVlIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1pZGRsZXdhcmUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgeyBwYXRobmFtZSB9ID0gcmVxdWVzdC5uZXh0VXJsXG4gIFxuICAvLyDwn5SQIOWuieWFqOajgOafpVxuICBjb25zdCBzZWN1cml0eUNoZWNrID0gcGVyZm9ybVNlY3VyaXR5Q2hlY2tzKHJlcXVlc3QpXG4gIGlmICghc2VjdXJpdHlDaGVjay5hbGxvd2VkKSB7XG4gICAgY29uc29sZS5sb2coYPCflJIgU2VjdXJpdHkgYmxvY2s6ICR7c2VjdXJpdHlDaGVjay5yZWFzb259IGZyb20gJHtyZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKSB8fCAndW5rbm93bid9YClcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnUmVxdWVzdCBibG9ja2VkIGZvciBzZWN1cml0eSByZWFzb25zJyB9LFxuICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgKVxuICB9XG4gIFxuICAvLyDlvLrliLZIVFRQU+mHjeWumuWQkSAo55Sf5Lqn546v5aKDKVxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xuICAgIGNvbnN0IHByb3RvID0gcmVxdWVzdC5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtcHJvdG8nKVxuICAgIGlmIChwcm90byA9PT0gJ2h0dHAnKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KGBodHRwczovL2ZsdXhrb250ZXh0LnNwYWNlJHtwYXRobmFtZX1gLCAzMDEpXG4gICAgfVxuICB9XG4gIFxuICAvLyBBUEkgdjEg6Lev55Sx6YeN5YaZIC0g5bCG5paH5qGj5Lit55qEQVBJ56uv54K55pig5bCE5Yiw5a6e6ZmF5a6e546wXG4gIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpL3YxLycpKSB7XG4gICAgbGV0IG5ld1BhdGggPSAnL2FwaS9mbHV4LWtvbnRleHQnXG4gICAgbGV0IGFjdGlvbiA9ICcnXG4gICAgXG4gICAgLy8g5qC55o2uVVJM6Lev5b6E56Gu5a6aYWN0aW9u57G75Z6LXG4gICAgaWYgKHBhdGhuYW1lLmluY2x1ZGVzKCcvdGV4dC10by1pbWFnZS9wcm8nKSkge1xuICAgICAgYWN0aW9uID0gJ3RleHQtdG8taW1hZ2UtcHJvJ1xuICAgIH0gZWxzZSBpZiAocGF0aG5hbWUuaW5jbHVkZXMoJy90ZXh0LXRvLWltYWdlL21heCcpKSB7XG4gICAgICBhY3Rpb24gPSAnZWRpdC1pbWFnZS1tYXgnXG4gICAgfSBlbHNlIGlmIChwYXRobmFtZS5pbmNsdWRlcygnL2ltYWdlLWVkaXQvcHJvJykpIHtcbiAgICAgIGFjdGlvbiA9ICdlZGl0LWltYWdlLXBybydcbiAgICB9IGVsc2UgaWYgKHBhdGhuYW1lLmluY2x1ZGVzKCcvaW1hZ2UtZWRpdC9tYXgnKSkge1xuICAgICAgYWN0aW9uID0gJ2VkaXQtaW1hZ2UtbWF4J1xuICAgIH1cbiAgICBcbiAgICAvLyDliJvlu7rmlrDnmoRVUkzlubbmt7vliqBhY3Rpb27lj4LmlbBcbiAgICBjb25zdCB1cmwgPSByZXF1ZXN0Lm5leHRVcmwuY2xvbmUoKVxuICAgIHVybC5wYXRobmFtZSA9IG5ld1BhdGhcbiAgICBcbiAgICAvLyDlpoLmnpznoa7lrprkuoZhY3Rpb27vvIzmt7vliqDliLDmn6Xor6Llj4LmlbDkuK1cbiAgICBpZiAoYWN0aW9uKSB7XG4gICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldCgnYWN0aW9uJywgYWN0aW9uKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJld3JpdGUodXJsKVxuICB9XG4gIFxuICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KClcbiAgXG4gIC8vIOa3u+WKoOWuieWFqOWktFxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1GcmFtZS1PcHRpb25zJywgJ0RFTlknKVxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1Db250ZW50LVR5cGUtT3B0aW9ucycsICdub3NuaWZmJylcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1JlZmVycmVyLVBvbGljeScsICdzdHJpY3Qtb3JpZ2luLXdoZW4tY3Jvc3Mtb3JpZ2luJylcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtWFNTLVByb3RlY3Rpb24nLCAnMTsgbW9kZT1ibG9jaycpXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KFxuICAgICdTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5JyxcbiAgICAnbWF4LWFnZT0zMTUzNjAwMDsgaW5jbHVkZVN1YkRvbWFpbnMnXG4gIClcbiAgXG4gIC8vIPCflJAg5aKe5by655qE5YaF5a655a6J5YWo562W55WlXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KFxuICAgICdDb250ZW50LVNlY3VyaXR5LVBvbGljeScsXG4gICAgXCJkZWZhdWx0LXNyYyAnc2VsZic7IFwiICtcbiAgICBcInNjcmlwdC1zcmMgJ3NlbGYnICd1bnNhZmUtaW5saW5lJyAndW5zYWZlLWV2YWwnIFwiICtcbiAgICBcImh0dHBzOi8vcGxhdGZvcm0udHdpdHRlci5jb20gXCIgK1xuICAgIFwiaHR0cHM6Ly93d3cuZ29vZ2xldGFnbWFuYWdlci5jb20gXCIgK1xuICAgIFwiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tIFwiICtcbiAgICBcImh0dHBzOi8vYXBpcy5nb29nbGUuY29tIFwiICtcbiAgICBcImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tIFwiICtcbiAgICBcImh0dHBzOi8vZ3N0YXRpYy5jb20gXCIgK1xuICAgIFwiaHR0cHM6Ly9jaGFsbGVuZ2VzLmNsb3VkZmxhcmUuY29tIFwiICtcbiAgICBcImh0dHBzOi8vc3RhdGljLmNsb3VkZmxhcmVpbnNpZ2h0cy5jb20gXCIgK1xuICAgIFwiZGF0YTogYmxvYjo7IFwiICtcbiAgICBcInN0eWxlLXNyYyAnc2VsZicgJ3Vuc2FmZS1pbmxpbmUnIFwiICtcbiAgICBcImh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20gXCIgK1xuICAgIFwiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tIFwiICtcbiAgICBcImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tOyBcIiArXG4gICAgXCJmb250LXNyYyAnc2VsZicgXCIgK1xuICAgIFwiaHR0cHM6Ly9mb250cy5nc3RhdGljLmNvbSBcIiArXG4gICAgXCJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20gXCIgK1xuICAgIFwiZGF0YTo7IFwiICtcbiAgICBcImltZy1zcmMgJ3NlbGYnIGRhdGE6IGh0dHBzOiBibG9iOjsgXCIgK1xuICAgIFwiY29ubmVjdC1zcmMgJ3NlbGYnIGh0dHBzOiBcIiArXG4gICAgXCJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20gXCIgK1xuICAgIFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20gXCIgK1xuICAgIFwiaHR0cHM6Ly9jaGFsbGVuZ2VzLmNsb3VkZmxhcmUuY29tIFwiICtcbiAgICBcIndzczogd3M6OyBcIiArXG4gICAgXCJmcmFtZS1zcmMgJ3NlbGYnIFwiICtcbiAgICBcImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbSBcIiArXG4gICAgXCJodHRwczovL3d3dy5nb29nbGUuY29tIFwiICtcbiAgICBcImh0dHBzOi8vY2hhbGxlbmdlcy5jbG91ZGZsYXJlLmNvbTsgXCIgK1xuICAgIFwib2JqZWN0LXNyYyAnbm9uZSc7IFwiICtcbiAgICBcImJhc2UtdXJpICdzZWxmJzsgXCIgK1xuICAgIFwiZm9ybS1hY3Rpb24gJ3NlbGYnIGh0dHBzOjsgXCIgK1xuICAgIFwiZnJhbWUtYW5jZXN0b3JzICdzZWxmJzsgXCIgK1xuICAgIFwidXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cztcIlxuICApXG4gIFxuICAvLyDwn5SQIOa3u+WKoOabtOWkmuWuieWFqOWktFxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnUGVybWlzc2lvbnMtUG9saWN5JywgJ2NhbWVyYT0oKSwgbWljcm9waG9uZT0oKSwgZ2VvbG9jYXRpb249KCknKVxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnWC1ETlMtUHJlZmV0Y2gtQ29udHJvbCcsICdvZmYnKVxuICBcbiAgLy8gQVBJ6Lev55Sx6YCf546H6ZmQ5Yi2ICjku4XlnKjnlJ/kuqfnjq/looPlkK/nlKgpXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nICYmIHJlcXVlc3QubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpLycpKSB7XG4gICAgY29uc3QgZm9yd2FyZGVkID0gcmVxdWVzdC5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtZm9yJylcbiAgICBjb25zdCBpcCA9IGZvcndhcmRlZCA/IGZvcndhcmRlZC5zcGxpdCgnLCcpWzBdLnRyaW0oKSA6IFxuICAgICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzLmdldCgneC1yZWFsLWlwJykgPz8gXG4gICAgICAgICAgICAgICAnMTI3LjAuMC4xJ1xuICAgIFxuICAgIC8vIOS4jeWQjEFQSeerr+eCueS4jeWQjOeahOmZkOWItlxuICAgIGxldCBsaW1pdCA9IDEwXG4gICAgbGV0IHdpbmRvd01zID0gNjAwMDAgLy8gMeWIhumSn1xuICAgIFxuICAgIGlmIChyZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUuaW5jbHVkZXMoJy9hdXRoLycpKSB7XG4gICAgICBsaW1pdCA9IDIwIC8vIOeUn+S6p+eOr+Wig+iupOivgeaUvuWuvVxuICAgICAgd2luZG93TXMgPSAzMDAwMDAgLy8gNeWIhumSn1xuICAgIH0gZWxzZSBpZiAocmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lLmluY2x1ZGVzKCcvcGF5bWVudC8nKSkge1xuICAgICAgbGltaXQgPSAxMCAvLyDnlJ/kuqfnjq/looPmlK/ku5jmlL7lrr1cbiAgICAgIHdpbmRvd01zID0gNjAwMDAwIC8vIDEw5YiG6ZKfXG4gICAgfSBlbHNlIGlmIChyZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUuaW5jbHVkZXMoJy9yZW1vdmUtd2F0ZXJtYXJrJykgfHwgXG4gICAgICAgICAgICAgICByZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUuaW5jbHVkZXMoJy9lbmhhbmNlLWltYWdlJykpIHtcbiAgICAgIGxpbWl0ID0gNSAvLyDlm77niYflpITnkIZBUEnpmZDliLbmm7TkuKXmoLxcbiAgICAgIHdpbmRvd01zID0gNjAwMDAgLy8gMeWIhumSn1xuICAgIH1cbiAgICBcbiAgICBpZiAoIXJhdGVMaW1pdChpcCwgbGltaXQsIHdpbmRvd01zKSkge1xuICAgICAgY29uc29sZS5sb2coYPCflJIgUmF0ZSBsaW1pdCBleGNlZWRlZCBmb3IgSVA6ICR7aXB9IG9uICR7cmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lfWApXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdSYXRlIGxpbWl0IGV4Y2VlZGVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDI5IH1cbiAgICAgIClcbiAgICB9XG4gIH1cbiAgXG4gIC8vIPCflJAg6K6w5b2V5Y+v55aR6K+35rGCXG4gIGNvbnN0IHN1c3BpY2lvdXNQYXR0ZXJucyA9IFtcbiAgICAvXFwuXFwuXFwvLywgLy8g6Lev5b6E6YGN5Y6GXG4gICAgLzxzY3JpcHQvaSwgLy8gWFNTXG4gICAgL3VuaW9uLipzZWxlY3QvaSwgLy8gU1FM5rOo5YWlXG4gICAgL2phdmFzY3JpcHQ6L2ksIC8vIEphdmFTY3JpcHTljY/orq5cbiAgICAvb25cXHcrXFxzKj0vaSAvLyDkuovku7blpITnkIblmahcbiAgXVxuICBcbiAgY29uc3QgaXNTdXNwaWNpb3VzID0gc3VzcGljaW91c1BhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBcbiAgICBwYXR0ZXJuLnRlc3QocGF0aG5hbWUpIHx8IHBhdHRlcm4udGVzdChyZXF1ZXN0Lm5leHRVcmwuc2VhcmNoKVxuICApXG4gIFxuICBpZiAoaXNTdXNwaWNpb3VzKSB7XG4gICAgY29uc29sZS5sb2coYPCflJIgU3VzcGljaW91cyByZXF1ZXN0IGRldGVjdGVkOiAke3BhdGhuYW1lfSBmcm9tICR7cmVxdWVzdC5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtZm9yJykgfHwgJ3Vua25vd24nfWApXG4gIH1cbiAgXG4gIHJldHVybiByZXNwb25zZVxufVxuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBtYXRjaGVyOiBbXG4gICAgJy8oKD8hX25leHQvc3RhdGljfF9uZXh0L2ltYWdlfGZhdmljb24uaWNvKS4qKScsXG4gIF0sXG59ICJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJyYXRlTGltaXRNYXAiLCJNYXAiLCJyYXRlTGltaXQiLCJpcCIsImxpbWl0Iiwid2luZG93TXMiLCJub3ciLCJEYXRlIiwid2luZG93U3RhcnQiLCJyZWNvcmQiLCJnZXQiLCJsYXN0UmVzZXQiLCJzZXQiLCJjb3VudCIsInBlcmZvcm1TZWN1cml0eUNoZWNrcyIsInJlcXVlc3QiLCJ1cmwiLCJVUkwiLCJ1c2VyQWdlbnQiLCJoZWFkZXJzIiwic3VzcGljaW91c1VzZXJBZ2VudHMiLCJzb21lIiwicGF0dGVybiIsInRlc3QiLCJhbGxvd2VkIiwicmVhc29uIiwicGF0aG5hbWUiLCJpbmNsdWRlcyIsInNxbEluamVjdGlvblBhdHRlcm5zIiwic2VhcmNoIiwieHNzUGF0dGVybnMiLCJtaWRkbGV3YXJlIiwibmV4dFVybCIsInNlY3VyaXR5Q2hlY2siLCJjb25zb2xlIiwibG9nIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwicHJvY2VzcyIsInByb3RvIiwicmVkaXJlY3QiLCJzdGFydHNXaXRoIiwibmV3UGF0aCIsImFjdGlvbiIsImNsb25lIiwic2VhcmNoUGFyYW1zIiwicmV3cml0ZSIsInJlc3BvbnNlIiwibmV4dCIsImZvcndhcmRlZCIsInNwbGl0IiwidHJpbSIsInN1c3BpY2lvdXNQYXR0ZXJucyIsImlzU3VzcGljaW91cyIsImNvbmZpZyIsIm1hdGNoZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});